# ===============================
# Spring Profile: STAGING
# ===============================

spring.application.name=th-backend

# -----------------------------------
# Server Configuration
# -----------------------------------
server.port=8080
vaadin.productionMode=true

# -----------------------------------
# PostgreSQL Configuration
# -----------------------------------
spring.datasource.url=jdbc:postgresql://th-db:5432/th_backend
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=th_user
spring.datasource.password=${POSTGRES_PASSWORD}

# -----------------------------------
# JPA / Hibernate Configuration
# -----------------------------------
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=true
spring.jpa.properties.hibernate.dialect=org.hibernate.spatial.dialect.postgis.PostgisPG10Dialect

# -----------------------------------
# RabbitMQ Configuration
# -----------------------------------
spring.rabbitmq.host=th-rabbitmq
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# -----------------------------------
# JWT Configuration
# -----------------------------------
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_TIME}
jwt.refresh=${JWT_REFRESH_TIME}
jwt.refresh-expiration=604800000

# -----------------------------------
# Logging (moderate verbosity for staging)
# -----------------------------------
logging.level.root=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# -----------------------------------
# Spring Security / OAuth2
# -----------------------------------
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://accounts.google.com

# -----------------------------------
# Spring mail Configuration
# -----------------------------------
spring.mail.host=${MAIL_HOST}
spring.mail.port=465
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}

# Corrected typo: sll -> ssl
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.ssl.enable=true
spring.mail.properties.mail.smtp.ssl.trust=mail.dmcs.pl
# This next line is often needed for modern Jakarta Mail to ignore name mismatches
spring.mail.properties.mail.smtp.ssl.checkserveridentity=false

# Use the SMTPS socket factory for port 465
spring.mail.properties.mail.smtp.socketFactory.port=465
spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
spring.mail.properties.mail.smtp.socketFactory.fallback=false

spring.mail.default-encoding=UTF-8
spring.mail.properties.mail.smtp.connectiontimeout=15000
spring.mail.properties.mail.smtp.timeout=30000
spring.mail.properties.mail.smtp.writetimeout=15000
spring.mail.properties.mail.smtp.debug=true

